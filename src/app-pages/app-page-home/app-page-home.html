<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/geo-location/geo-location.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="../../../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">

<link rel="import" href="../../app-behaviors/app-localize-behavior.html">
<link rel="import" href="../../app-themes/current-theme/shared-styles/pages-shared-styles.html">

<link rel="import" href="../../app-widgets/app-widget-current.html">
<link rel="import" href="../../app-widgets/app-widget-wind.html">
<link rel="import" href="../../app-widgets/app-widget-camera.html">
<link rel="import" href="../../app-widgets/app-widget-proverb.html">

<link rel="import" href="app-icons-home.html">

<dom-module id="app-page-home">

  <template>

  <style include="pages-shared-styles">

  :host {
    display: block;
  }

  /* Landscape phone height */
  @media screen and (orientation: landscape) and (max-height: 450px) {

  }

  /* Landscape phone minimal height - iPhone 4 */
  @media screen and (orientation: landscape) and (max-height: 320px) {

  }

  /* Print mode */
  @media print {

  }

  .row paper-card {
    margin: 10px;
    width: calc(100% - 20px);
  }

  paper-card.dark {
    color: #f5f5f5;
    --paper-card-header-color: #f5f5f5;
  }

  .text-muted {
    color: var(--disabled-text-color);
  }

  .text-center {
    text-align: center;
  }

  .col-padding {
    padding-left: 16px;
    padding-right: 16px
  }



  </style>

  <firebase-document id="live" app-name="bazdara" path="/live" data="{{live}}"></firebase-document>
  <firebase-document id="trenutno" app-name="bazdara" path="/trenutno" data="{{trenutno}}"></firebase-document>

  <geo-location latitude="{{lat}}" longitude="{{lng}}"></geo-location>


  <iron-media-query query="(max-width: 767px)" query-matches="{{mobile}}"></iron-media-query>

  <div class="Page-container Page-container--small" id="section1">

    <div class="row">
      <div class="col-md-6 col-xl-4 col-xxl-3">



        <paper-card elevation="2" style="min-height:190px">
          <app-widget-current trenutno$="[[trenutno]]" live$="[[live]]"></app-widget-current>
        </paper-card>

        <paper-card elevation="2" style="min-height:190px">
          <app-widget-wind direction$="[[live.currentWindDirection]]" name$="[[live.currentWindDirection]]" speed$="[[live.currentWindSpeed]]" gust$="[[trenutno.veter.zdajÌ‰]]"></app-widget-wind>
        </paper-card>

        <paper-card elevation="2" style="min-height:160px">
          <app-widget-camera lat="[[lat]]" lng="[[lng]]"></app-widget-camera>
        </paper-card>

        <paper-card class="dark" style="background-color:#F44336;min-height:110px" elevation="2">
          <app-widget-proverb proverb$="[[trenutno.pregovor]]"></app-widget-proverb>
        </paper-card>

      </div>

      <iron-scroll-threshold scroll-target="document" lower-threshold="800" on-lower-threshold="loadMeteo">
      </iron-scroll-threshold>

      <div class="col-md-6 col-xl-8 col-xxl-7">

        <paper-card elevation="2" style="background-color:#ffffff;height:310px">
          <app-widget-meteogram id="meteo"></app-widget-meteogram>
        </paper-card>
        <iron-scroll-threshold lower-threshold="500" scroll-target="document" on-lower-threshold="loadTide">
        </iron-scroll-threshold>


        <paper-card elevation="2" style="background-color:#ffffff;height:420px">
          <app-widget-tide id="tide"></app-widget-tide>
        </paper-card>
        <iron-scroll-threshold scroll-target="document" lower-threshold="300" on-lower-threshold="loadGauges">
        </iron-scroll-threshold>
      </div>


      <div class="col-md-12 col-xl-12 col-xxl-2">

          <app-widget-gauges trenutno$="[[trenutno]]" live$="[[live]]"></app-widget-gauges>
          <iron-scroll-threshold lower-threshold="150" scroll-target="document" on-lower-threshold="loadNapoved">
          </iron-scroll-threshold>

      </div>
      <div class="col-xs-12">

        <app-widget-napoved id="napoved"></app-widget-napoved>

      </div>
    </div>

  </div>



</template>

  <script>
    Polymer({

      is: 'app-page-home',

      properties: {
        active: {
          type: Boolean,
          value: false,
          observer: '_activeChanged'
        },

        app: Object,

        _isLocalesLoaded: {
          type: Boolean,
          value: false
        },

        trenutno: {
          type: Object,
          notify: true
        },
        live: {
          type: Object,
          notify: true
        },
      },

      behaviors: [
        AppBehaviors.AppLocalizeBehavior
      ],

      listeners: {
        'app-resources-loaded': '_onLocalesLoaded'
      },

      loadMeteo: function() {

        if (Polymer.isInstance(this.$.meteo)) {
          //
        } else {
          this.importHref(this.resolveUrl('../../app-widgets/app-widget-meteogram.html'), function() {
            //
          });
        };

      },

      loadTide: function() {

        if (Polymer.isInstance(this.$.tide)) {
          //
        } else {
          this.importHref(this.resolveUrl('../../app-widgets/app-widget-tide.html'), function() {
            //
          });
        };

      },

      loadNapoved: function() {

        if (Polymer.isInstance(this.$.napoved)) {
          //
        } else {
          this.importHref(this.resolveUrl('../../app-widgets/app-widget-napoved.html'), function() {
            //
          });
        };

      },

      loadGauges: function() {

        if (Polymer.isInstance(this.$.gauges)) {
          //
        } else {
          this.importHref(this.resolveUrl('../../app-widgets/app-widget-gauges.html'), function() {
            //
          });
        };

      },

      _activeChanged: function() {
        if (this.active) {
          if (this._isLocalesLoaded) {
            this.set('app.pageTitle', this.localize('home'));
          } else {
            this.loadLocales(this.is);
          }
        }
      },

      _onLocalesLoaded: function(event) {
        event.stopPropagation();
        this._isLocalesLoaded = true;
        // TODO: Resolve slow localize data binding in Firefox
        //this.style.display = 'block';
        this.set('app.pageTitle', this.localize('home'));
      },

    });
  </script>

</dom-module>
